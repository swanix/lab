<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Debug Auth0 Callback">
  <title>Debug Auth0 Callback</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: white;
    }
    
    .debug-container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 2rem;
      border-radius: 12px;
      backdrop-filter: blur(10px);
    }
    
    .debug-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .debug-section {
      margin-bottom: 2rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }
    
    .debug-section h3 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: #ffd700;
    }
    
    .debug-param {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }
    
    .debug-param-name {
      font-weight: 500;
      color: #ffd700;
    }
    
    .debug-param-value {
      word-break: break-all;
      max-width: 60%;
    }
    
    .debug-actions {
      text-align: center;
      margin-top: 2rem;
    }
    
    .debug-button {
      background: #ffd700;
      color: #333;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin: 0 10px;
      transition: background 0.3s ease;
    }
    
    .debug-button:hover {
      background: #ffed4e;
    }
    
    .error-highlight {
      background: rgba(255, 0, 0, 0.2);
      border: 1px solid #ff4444;
    }
    
    .success-highlight {
      background: rgba(0, 255, 0, 0.2);
      border: 1px solid #44ff44;
    }
  </style>
</head>
<body>
  <div class="debug-container">
    <h1 class="debug-title">üîç Debug Auth0 Callback</h1>
    
    <div class="debug-section">
      <h3>üìã URL Completa</h3>
      <div class="debug-param">
        <span class="debug-param-name">URL:</span>
        <span class="debug-param-value" id="full-url"></span>
      </div>
    </div>
    
    <div class="debug-section">
      <h3>üîç Par√°metros de URL</h3>
      <div id="url-params"></div>
    </div>
    
    <div class="debug-section">
      <h3>üåê Informaci√≥n del Navegador</h3>
      <div class="debug-param">
        <span class="debug-param-name">User Agent:</span>
        <span class="debug-param-value" id="user-agent"></span>
      </div>
      <div class="debug-param">
        <span class="debug-param-name">Referrer:</span>
        <span class="debug-param-value" id="referrer"></span>
      </div>
    </div>
    
    <div class="debug-section">
      <h3>‚è∞ Informaci√≥n Temporal</h3>
      <div class="debug-param">
        <span class="debug-param-name">Timestamp:</span>
        <span class="debug-param-value" id="timestamp"></span>
      </div>
    </div>
    
    <div class="debug-actions">
      <button class="debug-button" onclick="redirectToLogin()">üîô Ir al Login</button>
      <button class="debug-button" onclick="redirectToIndex()">üè† Ir a Index</button>
      <button class="debug-button" onclick="copyDebugInfo()">üìã Copiar Info</button>
    </div>
  </div>

  <script>
    // Capturar informaci√≥n de debug
    function captureDebugInfo() {
      const urlParams = new URLSearchParams(window.location.search);
      const fullUrl = window.location.href;
      
      // Mostrar URL completa
      document.getElementById('full-url').textContent = fullUrl;
      
      // Mostrar par√°metros de URL
      const urlParamsContainer = document.getElementById('url-params');
      urlParamsContainer.innerHTML = '';
      
      let hasError = false;
      let hasCode = false;
      
      for (const [key, value] of urlParams.entries()) {
        const paramDiv = document.createElement('div');
        paramDiv.className = 'debug-param';
        
        // Resaltar errores y c√≥digos
        if (key === 'error') {
          paramDiv.classList.add('error-highlight');
          hasError = true;
        } else if (key === 'code') {
          paramDiv.classList.add('success-highlight');
          hasCode = true;
        }
        
        paramDiv.innerHTML = `
          <span class="debug-param-name">${key}:</span>
          <span class="debug-param-value">${value}</span>
        `;
        
        urlParamsContainer.appendChild(paramDiv);
      }
      
      // Mostrar informaci√≥n del navegador
      document.getElementById('user-agent').textContent = navigator.userAgent;
      document.getElementById('referrer').textContent = document.referrer || 'No referrer';
      document.getElementById('timestamp').textContent = new Date().toISOString();
      
      // Log para consola
      console.log('üîç [Debug Callback] URL:', fullUrl);
      console.log('üîç [Debug Callback] Parameters:', Object.fromEntries(urlParams));
      console.log('üîç [Debug Callback] Has Error:', hasError);
      console.log('üîç [Debug Callback] Has Code:', hasCode);
      
      return { hasError, hasCode, urlParams };
    }
    
    // Funciones de redirecci√≥n
    function redirectToLogin() {
      window.location.href = '/login.html';
    }
    
    function redirectToIndex() {
      window.location.href = '/index.html';
    }
    
    function copyDebugInfo() {
      const debugInfo = {
        url: window.location.href,
        parameters: Object.fromEntries(new URLSearchParams(window.location.search)),
        userAgent: navigator.userAgent,
        referrer: document.referrer,
        timestamp: new Date().toISOString()
      };
      
      navigator.clipboard.writeText(JSON.stringify(debugInfo, null, 2))
        .then(() => alert('Informaci√≥n de debug copiada al portapapeles'))
        .catch(() => alert('No se pudo copiar la informaci√≥n'));
    }
    
    // Capturar informaci√≥n al cargar la p√°gina
    const debugInfo = captureDebugInfo();
    
    // Auto-redirecci√≥n despu√©s de 10 segundos
    setTimeout(() => {
      if (debugInfo.hasError) {
        console.log('üîç [Debug Callback] Auto-redirecting to forbidden.html due to error');
        window.location.href = '/forbidden.html' + window.location.search;
      } else if (debugInfo.hasCode) {
        console.log('üîç [Debug Callback] Auto-redirecting to auth-callback due to code');
        window.location.href = '/.netlify/functions/auth-callback' + window.location.search;
      } else {
        console.log('üîç [Debug Callback] Auto-redirecting to login due to no parameters');
        window.location.href = '/login.html';
      }
    }, 10000);
  </script>
</body>
</html>
